version: "1.0.0"

resilience:
  name: "default"
  description: "Default resilience policy for retry, circuit breaker, timeout, and graceful degradation"
  
  enable_circuit_breaker: true
  enable_retry: true
  enable_graceful_degradation: true
  
  retry_strategies:
    openai:
      max_attempts: 3
      backoff_type: "exponential"
      initial_delay: 1.0
      max_delay: 60.0
      multiplier: 2.0
      retryable_errors:
        - "rate_limit"
        - "timeout"
        - "service_unavailable"
        - "internal_server_error"
        - "connection"
    
    anthropic:
      max_attempts: 3
      backoff_type: "exponential"
      initial_delay: 1.0
      max_delay: 60.0
      multiplier: 2.0
      retryable_errors:
        - "rate_limit"
        - "timeout"
        - "service_unavailable"
        - "internal_server_error"
        - "connection"
    
    xai:
      max_attempts: 2
      backoff_type: "linear"
      initial_delay: 2.0
      max_delay: 30.0
      multiplier: 1.5
      retryable_errors:
        - "rate_limit"
        - "timeout"
        - "service_unavailable"
    
    manus:
      max_attempts: 2
      backoff_type: "linear"
      initial_delay: 2.0
      max_delay: 30.0
      multiplier: 1.5
      retryable_errors:
        - "rate_limit"
        - "timeout"
        - "service_unavailable"
    
    default:
      max_attempts: 3
      backoff_type: "exponential"
      initial_delay: 1.0
      max_delay: 60.0
      multiplier: 2.0
      retryable_errors:
        - "rate_limit"
        - "timeout"
        - "service_unavailable"
        - "internal_server_error"
  
  circuit_breakers:
    openai:
      failure_threshold: 5
      success_threshold: 2
      timeout: 60.0
      half_open_max_calls: 3
    
    anthropic:
      failure_threshold: 5
      success_threshold: 2
      timeout: 60.0
      half_open_max_calls: 3
    
    xai:
      failure_threshold: 3
      success_threshold: 1
      timeout: 30.0
      half_open_max_calls: 2
    
    manus:
      failure_threshold: 3
      success_threshold: 1
      timeout: 30.0
      half_open_max_calls: 2
    
    default:
      failure_threshold: 5
      success_threshold: 2
      timeout: 60.0
      half_open_max_calls: 3
  
  timeouts:
    default: 60.0
    per_provider:
      openai: 60.0
      anthropic: 60.0
      xai: 45.0
      manus: 45.0
    per_model:
      "gpt-4o": 90.0
      "gpt-4-turbo": 90.0
      "claude-3-opus": 90.0
      "gpt-4o-mini": 45.0
      "claude-3-haiku": 45.0
    per_endpoint:
      "/v1/chat": 60.0
      "/v1/chat/stream": 120.0
  
  graceful_degradation:
    - condition: "error_type"
      threshold: "rate_limit"
      action: "downgrade_model"
      fallback_model: "gpt-4o-mini"
    
    - condition: "error_type"
      threshold: "timeout"
      action: "use_fallback"
      fallback_provider: "anthropic"
      fallback_model: "claude-3-haiku"
    
    - condition: "latency_threshold"
      threshold: 5000
      action: "downgrade_model"
      max_latency: 5000.0
    
    - condition: "provider_failure"
      threshold: "circuit_open"
      action: "use_fallback"
      fallback_provider: "anthropic"
      fallback_model: "claude-3-haiku"

